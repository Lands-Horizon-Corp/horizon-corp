name: Frontend Pipeline

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    # lint:
    #     name: Lint Code
    #     runs-on: ubuntu-latest

    #     steps:
    #         - name: Checkout code
    #           uses: actions/checkout@v3

    #         - name: Set up Node.js
    #           uses: actions/setup-node@v3
    #           with:
    #               node-version: "22.11.0"

    #         - name: Install pnpm
    #           run: npm install -g pnpm@9.14.3

    #         - name: Install dependencies
    #           run: pnpm install
    #           working-directory: ./client

    #         - name: Run ESLint
    #           run: pnpm run lint
    #           working-directory: ./client

    #         - name: Run Prettier Check
    #           run: pnpm run fc
    #           working-directory: ./client

    # test:
    #     name: Run Vitest Tests
    #     runs-on: ubuntu-latest
    #     needs: lint

    #     steps:
    #         - name: Checkout code
    #           uses: actions/checkout@v3

    #         - name: Set up Node.js
    #           uses: actions/setup-node@v3
    #           with:
    #               node-version: "22.11.0"

    #         - name: Install pnpm
    #           run: npm install -g pnpm@9.14.3

    #         - name: Install dependencies
    #           run: pnpm install
    #           working-directory: ./client

    #         - name: Run Vitest tests
    #           run: pnpm run test
    #           working-directory: ./client

    # build:
    #     name: Build Project
    #     runs-on: ubuntu-latest
    #     needs: test

    #     steps:
    #         - name: Checkout code
    #           uses: actions/checkout@v3

    #         - name: Set up Node.js
    #           uses: actions/setup-node@v3
    #           with:
    #               node-version: "22.11.0"

    #         - name: Install pnpm
    #           run: npm install -g pnpm@9.14.3

    #         - name: Install dependencies
    #           run: pnpm install
    #           working-directory: ./client

    #         - name: Run TypeScript Build
    #           run: pnpm run build
    #           working-directory: ./client

    #         - name: Run Vite Build
    #           run: pnpm run build
    #           working-directory: ./client
deploy:
    runs-on: ubuntu-latest
    env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}
    steps:
        - name: Checkout Repository
          uses: actions/checkout@v3

        - name: Set up Node.js
          uses: actions/setup-node@v3
          with:
              node-version: "22.11.0"

        - name: Check Node.js version
          run: |
              node --version
              npx --version

        - name: Install pnpm (v9.14.3)
          run: npm install -g pnpm@9.14.3

        - name: Install Dependencies
          working-directory: client
          run: pnpm install

        - name: Build React App
          working-directory: client
          run: pnpm run build

        - name: Install s3-deploy
          run: npm install -g s3-deploy

        - name: Deploy to S3 & Invalidate CloudFront
          run: npx s3-deploy@1.4.0 ./** --bucket ${{ secrets.STORAGE_BUCKET_NAME }} --cwd . --distId ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --etag --gzip xml,html,htm,js,css,ttf,otf,svg,txt --invalidate /* --noCache
